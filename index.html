<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>나니키루 플래시카드</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <div class="app">
    <section class="panel">
      <div class="hd">
        <div class="title">문제 관리</div>
        <button class="btn primary small" id="btnOpenAdd">+ 문제 추가</button>
      </div>
      <div class="bd">
        <div class="stat">
          <div class="box">
            <div class="k">기본 문제 수</div>
            <div class="v" id="statBase">0</div>
          </div>
          <div class="box">
            <div class="k">즐겨찾기</div>
            <div class="v" id="statFav">0</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="col">
          <div class="row">
            <label class="swapLabel" title="수패, 객풍패, 삼원패를 무작위로 치환합니다.">
              <input type="checkbox" id="toggleRandomize" />
              종류 치환
            </label>

            <label class="swapLabel" title="체크: 다음 문제가 무작위(셔플)로 선택됩니다. 해제: 현재 선택된 문제의 다음 문제를 선택합니다.">
              <input type="checkbox" id="toggleShuffle" checked />
              셔플
            </label>

            <label class="swapLabel" title="체크: 즐겨찾기 문제만 대상으로 문제를 선택합니다.">
              <input type="checkbox" id="toggleFavOnly" />
              즐겨찾기만
            </label>
          </div>
        </div>

        <div class="hr"></div>

        <div class="row" style="justify-content:space-between; align-items:flex-end">
          <div class="col" style="gap:6px">
            <div class="title" style="font-size:14px">문제 목록</div>
            <div class="muted">목록에서 클릭하면 해당 문제가 오른쪽에 표시됨.</div>
          </div>

          <div class="row" style="gap:8px">
            <button class="btn small" id="btnCopyAllJsonMain">전체 JSON 복사</button>
            <button class="btn small" id="btnDownloadAllJsonMain">JSON 내보내기</button>
            <button class="btn danger small" id="btnClearAll">전체 삭제</button>
          </div>
        </div>

        <div class="list" id="problemList" style="margin-top:10px"></div>
      </div>
    </section>

    <main class="main">
      <section class="card" id="flashcard">
        <div class="top">
          <div>
            <h1 class="h1" id="qTitle">아직 문제를 시작하지 않았어.</h1>
            <div class="meta2" id="qMeta"></div>
          </div>

          <div class="row" style="gap:8px; align-items:flex-start">
            <button class="star" id="btnFavInCard" title="현재 문제 즐겨찾기">
              <svg viewBox="0 0 24 24" fill="none" stroke="#9aa6b2" stroke-width="2">
                <path d="M12 17.3l-6.18 3.7 1.64-7.03L2 9.24l7.19-.61L12 2l2.81 6.63 7.19.61-5.46 4.73 1.64 7.03z"/>
              </svg>
            </button>
            <button class="btn small" id="btnPrev" disabled title="이전: 방금까지 풀었던 문제 히스토리로 이동 (PgUp)">이전 (PgUp)</button>
            <button class="btn primary small" id="btnReveal" disabled title="정답 확인 (Enter)">정답 확인 (Enter)</button>
            <button class="btn small" id="btnNext" disabled title="다음: 조건(셔플/즐겨찾기만/종류치환)에 따라 새 문제 선택 (PgDn)">다음 (PgDn)</button>
          </div>
        </div>

        <div class="muted" style="margin-top:-6px; margin-bottom:10px">
          Enter: 정답 확인. ←/→: 선택 패 이동(기본=쯔모). 같은 패를 한 번 더 클릭: 정답 확인. 이전(PgUp): 히스토리 이동. 다음(PgDn): 조건에 따라 새 문제.
        </div>

        <div class="twoCol">
          <div class="box">
            <h3>현재 정보</h3>
            <div class="rowLine" id="metaBox"></div>
          </div>

          <div class="box">
            <h3>도라</h3>
            <div class="rowLine doraTiles" id="doraIndicatorBox"></div>
          </div>
        </div>

        <div style="height:10px"></div>

        <div class="box">
          <h3>손패 (14장, 맨 오른쪽 = 쯔모)</h3>
          <div class="tilesWrap" id="tiles"></div>
          <div class="muted" style="margin-top:8px">←/→로 선택을 옮기거나 클릭한 다음, <b>정답 확인</b>을 눌러봐.</div>
          <div id="meldsLines" class="muted" style="margin-top:10px; white-space:pre-wrap; display:none"></div>
        </div>

        <div class="result" id="result" style="display:none"></div>
      </section>
    </main>
  </div>

  <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="hd">
        <div class="title" id="modalTitle">문제 추가</div>
        <button class="btn icon" id="btnCloseModal" aria-label="닫기">✕</button>
      </div>

      <div class="bd">
        <div class="grid">
          <div class="field">
            <label>문제 이름</label>
            <input id="fTitle" placeholder="예: 타쯔오버에서 뭐 버리나?" />
          </div>

          <div class="field">
            <label>장풍(국)</label>
            <select id="fRound">
              <option>동1국</option><option>동2국</option><option>동3국</option><option>동4국</option>
              <option>남1국</option><option>남2국</option><option>남3국</option><option>남4국</option>
            </select>
          </div>

          <div class="field">
            <label>현재 순</label>
            <select id="fTurn"></select>
            <div class="help">예: 1순, 2순… (여기서는 숫자만 저장)</div>
          </div>

          <div class="field">
            <label>자풍</label>
            <input id="fSeatWind" list="seatWindList" placeholder="동/남/서/북 또는 1~4" />
            <datalist id="seatWindList">
              <option value="동"></option>
              <option value="남"></option>
              <option value="서"></option>
              <option value="북"></option>
              <option value="1"></option>
              <option value="2"></option>
              <option value="3"></option>
              <option value="4"></option>
            </datalist>
            <div class="help">1=동, 2=남, 3=서, 4=북</div>
          </div>

          <div class="field">
            <label>추가 정보(조건) (선택)</label>
            <input id="fCondition" placeholder="예: 아가리톱, 압박, 오야, ..." />
            <div class="help">콤마/공백으로 구분해 저장. (예: 아가리톱, 텐파이율중시)</div>
          </div>

          <div class="field">
            <label>도라표지패 (1~5개)</label>
            <input id="fDora" placeholder="예: 9s / 9s,1m / 9s1m3z (최대 5개)" />
            <div class="help">m/p/s/z 표기. 적5는 0.</div>
          </div>
          
          <div class="field" style="grid-column: 1 / -1">
            <label>패 상황 (한 줄)</label>
            <input id="fHand" placeholder="예: 129m0789p3468s44z7m" />
            <div class="help">
              m=만, p=통, s=삭, z=자패(1z동 2z남 3z서 4z북 5z백 6z발 7z중), 적도라=0. 맨 오른쪽이 쯔모패.
              <b>>후로가 있더라도 14번째 패가 쯔모패 </b>
            </div>
          </div>

          <div class="field">
            <label>후로 (선택)</label>
            <input id="fMelds" placeholder="예: 666'm, 23'4s, 4444'z" />
            <div class="help">콤마/공백으로 구분. 예: 666'm(퐁), 23'4s(치), 111'1p(명깡), 4444'z(안깡)</div>
          </div>
          
          <div class="field">
            <label>정답(버릴 패)</label>
            <input id="fAnswer" placeholder="예: 1m (여러개면 1m,9m 처럼)" />
          </div>
          
          <div class="field" style="grid-column: 1 / -1">
            <label>해설 링크 (선택)</label>
            <input id="fLink" placeholder="예: https://..." />
          </div>

          <div class="field" style="grid-column: 1 / -1">
            <label>문제 해설 글 (선택, 길게)</label>
            <textarea id="fExplanation" placeholder="해설을 여기에 적어도 되고, 링크만 넣어도 돼."></textarea>
          </div>

          <div class="field" style="grid-column: 1 / -1">
            <div class="hr"></div>
            <label>일괄 추가하기 (JSON)</label>
            <div class="row" style="align-items:stretch">
              <input id="bulkJsonText" placeholder='여기에 JSON 배열을 붙여넣기 (예: [{"title":"...",...}, ...])' style="flex:1" />
              <button class="btn primary" id="btnBulkImport">일괄 추가</button>
              <button class="btn small" id="btnAttachJson">json 파일 첨부</button>
              <input type="file" id="jsonFileInput" accept="application/json,.json" style="display:none" />
            </div>
            <div class="help">붙여넣기/파일첨부 후 “일괄 추가”를 누르면 여러 문제가 추가돼. (저장 버튼도 일괄 추가를 우선 처리함)</div>
          </div>
        </div>

      </div>

      <div class="ft">
        <div class="muted">저장 시 로컬스토리지에 보관됨.</div>
        <div class="row">
          <button class="btn small" id="btnCopyCurrentJsonInModal">현재 JSON 복사</button>
          <button class="btn" id="btnCancelModal">취소</button>
          <button class="btn primary" id="btnSave">저장</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/app.js"></script>
</body>
</html>